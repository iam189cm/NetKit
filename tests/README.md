# NetKit æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•è¿è¡ŒNetKité¡¹ç›®çš„å„ç§æµ‹è¯•ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

æœ¬é¡¹ç›®åŒ…å«ä»¥ä¸‹ç±»å‹çš„æµ‹è¯•ï¼š

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
- **ä½ç½®**: `tests/unit/`
- **è¦†ç›–**: æœåŠ¡å±‚å‡½æ•°å’Œç±»çš„ç‹¬ç«‹æµ‹è¯•
- **ç›®æ ‡è¦†ç›–ç‡**: 85%ä»¥ä¸Š
- **æµ‹è¯•å†…å®¹**:
  - ç½‘ç»œæ¥å£è·å–å’Œè§£æ
  - IPé…ç½®éªŒè¯
  - é…ç½®æ–‡ä»¶ç®¡ç†
  - ç½‘ç»œå†²çªæ£€æŸ¥
  - é”™è¯¯å¤„ç†

### 2. GUIæµ‹è¯• (GUI Tests)
- **ä½ç½®**: `tests/gui/`
- **è¦†ç›–**: ç”¨æˆ·ç•Œé¢ç»„ä»¶å’Œäº¤äº’æµ‹è¯•
- **æµ‹è¯•å†…å®¹**:
  - ç•Œé¢ç»„ä»¶åˆå§‹åŒ–
  - ç”¨æˆ·è¾“å…¥éªŒè¯
  - æŒ‰é’®ç‚¹å‡»å“åº”
  - çŠ¶æ€æ˜¾ç¤ºæ›´æ–°
  - å®Œæ•´å·¥ä½œæµç¨‹

### 3. é›†æˆæµ‹è¯• (Integration Tests)
- **ä½ç½®**: `tests/integration/`
- **è¦†ç›–**: æœåŠ¡å±‚ä¸ç•Œé¢å±‚çš„å®Œæ•´äº¤äº’
- **æµ‹è¯•å†…å®¹**:
  - ç«¯åˆ°ç«¯é…ç½®æµç¨‹
  - é”™è¯¯å¤„ç†é›†æˆ
  - å¹¶å‘æ“ä½œæµ‹è¯•
  - é…ç½®ä¿å­˜å’ŒåŠ è½½

### 4. æ€§èƒ½æµ‹è¯• (Performance Tests)
- **ä½ç½®**: `tests/performance/`
- **è¦†ç›–**: ç³»ç»Ÿæ€§èƒ½å’Œå“åº”æ—¶é—´æµ‹è¯•
- **æµ‹è¯•å†…å®¹**:
  - åŸºå‡†æ€§èƒ½æµ‹è¯•
  - å¤§é‡æ•°æ®å¤„ç†
  - å†…å­˜ä½¿ç”¨ç›‘æ§
  - å“åº”æ—¶é—´éªŒè¯

### 5. å‹åŠ›æµ‹è¯• (Stress Tests)
- **ä½ç½®**: `tests/performance/`
- **è¦†ç›–**: æé™æ¡ä»¶ä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§
- **æµ‹è¯•å†…å®¹**:
  - é«˜å¹¶å‘æ“ä½œ
  - å†…å­˜æ³„æ¼æ£€æµ‹
  - é•¿æ—¶é—´è¿è¡Œæµ‹è¯•
  - é”™è¯¯æ¢å¤èƒ½åŠ›

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ (æ¨è)

```bash
# Windows
run_tests.bat
```

é€‰æ‹©ç›¸åº”çš„æµ‹è¯•ç±»å‹ï¼š
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•  
3. GUIæµ‹è¯•
4. æ€§èƒ½æµ‹è¯•
5. å‹åŠ›æµ‹è¯•
6. æ‰€æœ‰æµ‹è¯•
7. å¿«é€Ÿæµ‹è¯•ï¼ˆä¸åŒ…å«æ…¢é€Ÿæµ‹è¯•ï¼‰
8. ä»…ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

### æ–¹æ³•2: ä½¿ç”¨Pythonè„šæœ¬

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python scripts/run_tests.py --type all --verbose

# è¿è¡Œå•å…ƒæµ‹è¯•
python scripts/run_tests.py --type unit --verbose

# è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼ˆåŒ…å«æ…¢é€Ÿæµ‹è¯•ï¼‰
python scripts/run_tests.py --type performance --verbose --include-slow

# ä»…ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python scripts/run_tests.py --coverage-only
```

### æ–¹æ³•3: ç›´æ¥ä½¿ç”¨pytest

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit/ -v -m "unit" --cov=netkit --cov=gui

# è¿è¡ŒGUIæµ‹è¯•
pytest tests/gui/ -v -m "gui"

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pytest tests/performance/ -v -m "performance"

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/unit/test_ip_switcher_service.py -v
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼Œä¼šç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

### HTMLæµ‹è¯•æŠ¥å‘Š
- **ä½ç½®**: `reports/`
- **å†…å®¹**: è¯¦ç»†çš„æµ‹è¯•ç»“æœã€å¤±è´¥åŸå› ã€æ‰§è¡Œæ—¶é—´
- **æ–‡ä»¶**:
  - `unit_report.html` - å•å…ƒæµ‹è¯•æŠ¥å‘Š
  - `integration_report.html` - é›†æˆæµ‹è¯•æŠ¥å‘Š
  - `gui_report.html` - GUIæµ‹è¯•æŠ¥å‘Š
  - `performance_report.html` - æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š
- **ä½ç½®**: `htmlcov/`
- **å…¥å£**: `htmlcov/index.html`
- **å†…å®¹**: ä»£ç è¦†ç›–ç‡ç»Ÿè®¡ã€æœªè¦†ç›–ä»£ç è¡Œ
- **ç›®æ ‡**: 85%ä»¥ä¸Šè¦†ç›–ç‡

### XMLæŠ¥å‘Š
- **ä½ç½®**: `coverage.xml`
- **ç”¨é€”**: CI/CDé›†æˆã€ä»£ç è´¨é‡å·¥å…·

## ğŸ”§ æµ‹è¯•é…ç½®

### pytesté…ç½®
æµ‹è¯•é…ç½®åœ¨ `pytest.ini` æ–‡ä»¶ä¸­ï¼š

```ini
[tool:pytest]
testpaths = tests
addopts = 
    -v
    --cov=netkit
    --cov=gui
    --cov-report=html
    --cov-fail-under=85
markers =
    unit: å•å…ƒæµ‹è¯•
    integration: é›†æˆæµ‹è¯•
    gui: GUIæµ‹è¯•
    performance: æ€§èƒ½æµ‹è¯•
    slow: æ…¢é€Ÿæµ‹è¯•
    windows: Windowsç‰¹å®šæµ‹è¯•
```

### æµ‹è¯•æ ‡è®° (Markers)
ä½¿ç”¨pytestæ ‡è®°æ¥åˆ†ç±»æµ‹è¯•ï¼š

```python
@pytest.mark.unit          # å•å…ƒæµ‹è¯•
@pytest.mark.integration   # é›†æˆæµ‹è¯•
@pytest.mark.gui           # GUIæµ‹è¯•
@pytest.mark.performance   # æ€§èƒ½æµ‹è¯•
@pytest.mark.slow          # æ…¢é€Ÿæµ‹è¯•
@pytest.mark.windows       # Windowsç‰¹å®šæµ‹è¯•
```

## ğŸ› ï¸ å¼€å‘æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•
1. é€‰æ‹©åˆé€‚çš„æµ‹è¯•ç±»å‹ç›®å½•
2. åˆ›å»ºä»¥ `test_` å¼€å¤´çš„æ–‡ä»¶
3. ç¼–å†™æµ‹è¯•å‡½æ•°ï¼ˆä»¥ `test_` å¼€å¤´ï¼‰
4. æ·»åŠ é€‚å½“çš„pytestæ ‡è®°
5. ä½¿ç”¨æµ‹è¯•æ•°æ®ï¼ˆ`tests/test_data.py`ï¼‰

### æµ‹è¯•æ•°æ®
æµ‹è¯•æ•°æ®ç»Ÿä¸€ç®¡ç†åœ¨ `tests/test_data.py`ï¼š

```python
from tests.test_data import (
    VALID_IP_CONFIGS,      # æœ‰æ•ˆIPé…ç½®
    INVALID_IP_CONFIGS,    # æ— æ•ˆIPé…ç½®
    MOCK_NETWORK_INTERFACES,  # æ¨¡æ‹Ÿç½‘ç»œæ¥å£
    PERFORMANCE_TEST_DATA,    # æ€§èƒ½æµ‹è¯•æ•°æ®
    STRESS_TEST_DATA         # å‹åŠ›æµ‹è¯•æ•°æ®
)
```

### Mockå’Œæ¨¡æ‹Ÿ
ä½¿ç”¨ `unittest.mock` æ¨¡æ‹Ÿç³»ç»Ÿè°ƒç”¨ï¼š

```python
from unittest.mock import patch, MagicMock

@patch('subprocess.run')
def test_network_operation(mock_run):
    mock_run.return_value.returncode = 0
    mock_run.return_value.stdout = "mock output"
    # æµ‹è¯•ä»£ç 
```

## ğŸ” è°ƒè¯•æµ‹è¯•

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
pytest tests/unit/test_ip_switcher_service.py::TestIPConfigValidation -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
pytest tests/unit/test_ip_switcher_service.py::TestIPConfigValidation::test_validate_ip_config_valid -v
```

### è°ƒè¯•å¤±è´¥çš„æµ‹è¯•
```bash
# è¯¦ç»†è¾“å‡º
pytest tests/unit/ -v --tb=long

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥å¤„åœæ­¢
pytest tests/unit/ -x

# æ˜¾ç¤ºæœ¬åœ°å˜é‡
pytest tests/unit/ --tb=short -l
```

### æ€§èƒ½åˆ†æ
```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
pytest tests/performance/ -v --benchmark-only

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
pytest tests/performance/ --benchmark-histogram
```

## ğŸš¦ CI/CDé›†æˆ

### GitHub Actions
é¡¹ç›®é…ç½®äº†è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µè§¦å‘ï¼š
- æ¨é€åˆ° `main` åˆ†æ”¯
- åˆ›å»ºPull Request
- å‘å¸ƒæ–°ç‰ˆæœ¬

### æµ‹è¯•çŸ©é˜µ
- **æ“ä½œç³»ç»Ÿ**: Windows 2019 (Win10), Windows 2022 (Win11)
- **Pythonç‰ˆæœ¬**: 3.12
- **æµ‹è¯•ç±»å‹**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€GUIæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•

### è¦†ç›–ç‡è¦æ±‚
- **æœ€ä½è¦†ç›–ç‡**: 85%
- **å¤±è´¥å¤„ç†**: è¦†ç›–ç‡ä¸è¶³æ—¶æ„å»ºå¤±è´¥
- **æŠ¥å‘Šä¸Šä¼ **: è‡ªåŠ¨ä¸Šä¼ åˆ°Codecov

## ğŸ“ æµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•å‘½å**: ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
2. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
3. **Mockä½¿ç”¨**: æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼Œç¡®ä¿æµ‹è¯•å¯é‡å¤
4. **è¾¹ç•Œæµ‹è¯•**: æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
5. **æ€§èƒ½æµ‹è¯•**: å…³æ³¨å…³é”®è·¯å¾„çš„æ€§èƒ½è¡¨ç°
6. **æ–‡æ¡£æ›´æ–°**: æ·»åŠ æ–°åŠŸèƒ½æ—¶åŒæ­¥æ›´æ–°æµ‹è¯•

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: æµ‹è¯•è¿è¡Œç¼“æ…¢
A: ä½¿ç”¨ `--include-slow` å‚æ•°æ§åˆ¶æ˜¯å¦è¿è¡Œæ…¢é€Ÿæµ‹è¯•

### Q: GUIæµ‹è¯•å¤±è´¥
A: ç¡®ä¿åœ¨æ”¯æŒå›¾å½¢ç•Œé¢çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œæˆ–ä½¿ç”¨è™šæ‹Ÿæ˜¾ç¤º

### Q: è¦†ç›–ç‡ä¸è¶³
A: æŸ¥çœ‹ `htmlcov/index.html` æ‰¾åˆ°æœªè¦†ç›–çš„ä»£ç è¡Œ

### Q: æ¨¡æ‹Ÿå‘½ä»¤å¤±è´¥
A: æ£€æŸ¥mocké…ç½®ï¼Œç¡®ä¿è¿”å›å€¼æ ¼å¼æ­£ç¡®

### Q: æƒé™é”™è¯¯
A: æŸäº›æµ‹è¯•éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œè¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ

## ğŸ“ æ”¯æŒ

å¦‚æœ‰æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šäº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æµ‹è¯•æ•°æ®å’Œmocké…ç½®
3. å‚è€ƒç°æœ‰æµ‹è¯•ç”¨ä¾‹
4. æäº¤Issueæè¿°é—®é¢˜ 