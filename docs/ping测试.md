# Ping测试功能设计文档

## 📋 需求概述

基于用户反馈，原ping测试界面过于复杂，需要重新设计为简洁直观的可视化界面。新界面采用方格显示方式，类似网络扫描工具的经典设计。

## 🎯 界面设计

### 整体布局（垂直三段式）

```
┌─────────────────────────────────────┐
│           上部分 - 设置区域            │
├─────────────────────────────────────┤
│                                     │
│        中部分 - 16x16方格显示区域      │
│                                     │
├─────────────────────────────────────┤
│          下部分 - 统计信息            │
└─────────────────────────────────────┘
```

## 🔧 详细设计规格

### 上部分 - 设置区域

**组件**：
- IP范围输入框：输入"192.168.1"，后面固定显示"/24"
- 开始扫描按钮
- 停止扫描按钮

**固定参数**：
- 超时时间：1000ms（不可调）
- 并发数：25个（不可调）
- 网段范围：固定/24，254个可用地址

### 中部分 - 方格显示区域

**布局**：
- 16x16网格布局
- 总共256个位置，其中254个有效（跳过.0和.255）
- 方格内显示IP最后一段数字（1-254）

**方格状态及颜色**：
- **初始状态**：灰色
- **扫描中**：黄色闪烁（1秒3次）
- **在线状态**：绿色  
- **离线状态**：红色

**交互功能**：
- **左键单击**：在鼠标附近弹窗显示详细信息
- **右键单击**：弹出菜单，选择"单独ping"
- **双击**：直接单独ping该IP

**详细信息弹窗内容**：
- IP地址
- 状态（在线/离线）
- 响应时间

### 下部分 - 统计信息

**显示内容**：
- 在线数量
- 离线数量
- 实时更新统计数据

## 🛠️ 技术实现要点

### 核心功能

1. **IP范围解析**
   - 解析用户输入的网段前缀（如"192.168.1"）
   - 自动生成.1-.254的IP列表
   - 跳过网络地址(.0)和广播地址(.255)

2. **并发扫描机制**
   - 使用线程池，最大25个并发
   - 每个IP的ping超时时间1000ms
   - 实时更新方格状态

3. **方格状态管理**
   - 使用状态机管理每个方格的状态转换
   - 闪烁效果使用定时器实现
   - 状态变化时立即更新UI

### 界面实现

1. **自适应布局**
   - 根据窗口大小自动调整方格尺寸
   - 保持16x16网格比例
   - 适当的方格间距

2. **交互响应**
   - 鼠标事件处理（单击、双击、右键）
   - 弹窗位置跟随鼠标
   - 右键菜单实现

3. **视觉效果**
   - 方格颜色渐变动画
   - 黄色闪烁效果（1秒3次）
   - 统一的颜色方案

## 📊 状态流转图

```
初始状态(灰色) → 扫描中(黄色闪烁) → 在线(绿色)
                                  ↘ 离线(红色)
```

## 🎨 视觉规范

### 颜色方案
- **灰色**：#CCCCCC（初始状态）
- **黄色**：#FFFF00（扫描中）
- **绿色**：#00FF00（在线）
- **红色**：#FF0000（离线）

### 字体规范
- 方格内数字：微软雅黑，适当大小
- 统计信息：微软雅黑，标准大小
- 按钮文字：微软雅黑，标准大小

## 🚀 实现优先级

### 第一阶段 - 基础功能
1. 创建新的方格布局界面
2. 实现基础的ping扫描功能
3. 方格状态显示和更新

### 第二阶段 - 交互功能
1. 鼠标交互（单击、双击、右键）
2. 详细信息弹窗
3. 单独ping功能

### 第三阶段 - 视觉优化
1. 闪烁动画效果
2. 界面自适应
3. 用户体验优化

## 📝 注意事项

1. **性能考虑**
   - 不需要缓存扫描结果
   - 方格更新频率控制，避免界面卡顿
   - 及时释放线程资源

2. **用户体验**
   - 扫描过程可视化，用户能看到进度
   - 交互反馈及时
   - 界面简洁直观

3. **兼容性**
   - 保持与现有NetKit架构的兼容
   - 使用统一的UI组件库
   - 遵循项目编码规范

## 🔄 与原有功能的关系

这个新的ping测试界面将替代原有的复杂ping界面，但保持底层服务的兼容性：
- 复用现有的ping服务模块
- 保持统一的错误处理机制
- 维护相同的配置接口 